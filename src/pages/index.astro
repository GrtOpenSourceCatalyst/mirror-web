---
import BasicLayout from "../layouts/BasicLayout.astro";
import MirrorList from "../components/MirrorList.svelte";
import PopularMirrors from "../components/PopularMirrors.svelte";
import "@/styles/global.css";

const pageTitle = "我的镜像站 | 高速文件下载服务";
const pageDescription =
  "提供各类开源软件、系统镜像的高速下载服务，让您快速获取需要的资源。";

// 在服务端获取镜像数据
let initialMirrors = [];
let initialError = null;

try {
  const response = await fetch("http://localhost:8082/static/tunasync.json");

  if (!response.ok) {
    throw new Error(`HTTP 错误: ${response.status}`);
  }

  const data = await response.json();
  initialMirrors = Object.entries(data).map(([name, info]) => ({
    name,
    ...info,
    // 格式化最后更新时间
    lastUpdated: new Date(info.last_update_ts * 1000).toLocaleString("zh-CN"),
  }));
} catch (err) {
  initialError = err.message;
  console.error("服务端获取数据失败:", err);
}
---

<BasicLayout title={pageTitle} description={pageDescription}>
  <div class="mx-auto w-full max-w-7xl">
    {/* Slogan Section based on the image */}
    <section class="text-foreground mb-8 rounded-lg px-6 py-10 text-left">
      {/* Added basic styling similar to image */}
      <h1 class="mb-3 text-4xl font-bold lg:text-5xl">
        Open Source Software Mirror
      </h1>
      <p class="text-lg lg:text-xl">
        Welcome to Central South University Mirror Station
      </p>
      <p class="text-foreground/70 text-sm">
        Let's make the world a better place together!
      </p>
    </section>

    {/* Existing Popular Mirrors Section */}
    <section class="mb-8">
      <MirrorList initialMirrors={initialMirrors} initialError={initialError} />
    </section>
  </div>
</BasicLayout>
